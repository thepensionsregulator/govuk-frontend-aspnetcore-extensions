# Configure a new Umbraco project

1. Ensure you have .NET 6.0.5 (SDK version 6.0.300) or better installed. Run `dotnet --list-sdks` to check.
2. Add `ThePensionsRegulator.GovUk.Frontend` and `ThePensionsRegulator.GovUk.Frontend.Umbraco` NuGet packages. You must explicitly install both packages in order for MSBuild actions to run, even though the first is a transative dependency of the second.
3. If you are working on a project for The Pensions Regulator, copy `Install-TPRGitHooks.ps1` to your repository and run it.
4. In your Umbraco project install [uSync for Umbraco](https://jumoo.co.uk/usync/) using NuGet.
5. In `appsettings.json` add the following configuration:

   ```json
   {
     "Umbraco": {
       "CMS": {
         "Global": {
           "UseHttps": true,
           "SanitizeTinyMce": true
         },
         "ModelsBuilder": {
           "ModelsMode": "SourceCodeManual",
           "ModelsDirectory": "~/Models/ModelsBuilder"
         },
         "RichTextEditor": {
           "ValidElements": "+a[id|rel|data-id|data-udi|rev|charset|hreflang|lang|tabindex|type|name|href|target|class],-strong/-b[class],-em/-i[class],-strike[class],p[id|class],-ol[class|reversed|start|type],-ul[class],-li[class],br[class],-sub[class],-sup[class],-blockquote[class],-table[class|id|lang],-tr[id|lang|class|rowspan],tbody[id|class],thead[id|class],tfoot[id|class],td[id|lang|class|colspan|rowspan|width],-th[id|lang|class|colspan|rowspan|width|scope],caption[id|lang|class],-div[id|class],-span[class],-pre[class],-h1[id|class],-h2[id|class],-h3[id|class],-h4[id|class],-h5[id|class],-h6[id|class],hr[class],small[class],dd[id|class|lang],dl[id|class|lang],dt[id|class|dir|lang]",
           "CustomConfig": {
             "table_advtab": "false",
             "table_cell_advtab": "false",
             "table_row_advtab": "false",
             "table_default_attributes": "{}",
             "table_default_styles": "{}",
             "table_class_list": "[{\"title\":\"None\",\"value\":\"\"},{\"title\": \"Width: three-quarters\",\"value\": \"govuk-!-width-three-quarters\"},{\"title\": \"Width: two-thirds\",\"value\": \"govuk-!-width-two-thirds\"},{\"title\": \"Width: one-half\",\"value\": \"govuk-!-width-one-half\"}]",
             "table_cell_class_list": "[{\"title\":\"None\",\"value\":\"\"},{\"title\": \"Numeric header cell\",\"value\": \"govuk-table__header--numeric\"},{\"title\": \"Numeric data cell\",\"value\": \"govuk-table__cell--numeric\"},{\"title\": \"Width: one-half\",\"value\": \"govuk-!-width-one-half\"},{\"title\": \"Width: one-third\",\"value\": \"govuk-!-width-one-third\"},{\"title\": \"Width: one-quarter\",\"value\": \"govuk-!-width-one-quarter\"}]"
           }
         }
       }
     }
   }
   ```

6. Rebuild and run your project. On the first run you will see the 'Install Umbraco' screen. Enter your name, email and create a password when prompted.
7. Go to the Umbraco back office at `/umbraco`. Navigate to Settings > uSync. In the 'Everything' box, click 'Import'.
8. On the document type where you want to use GOV.UK components, create a new property that uses the 'GOV.UK Block List' data type. Go to Settings > Models Builder and click 'Generate Models'.
9. On the template/view for the document type, where `Model.Blocks` is the block list property you just created, as represented by the model generated by Umbraco Models Builder for the document type, include the following:

   ```csharp
   <partial name="GOVUK/BlockList" model="Model.Blocks" />
   ```

   If you are using form components your page should look more like this:

   ```csharp
   <partial name="GOVUK/ErrorSummary" />

   @using (Html.BeginUmbracoForm<HomeSurfaceController>(nameof(HomeSurfaceController.Index), new {}, new { novalidate="novalidate" }))
   {
     <partial name="GOVUK/BlockList" model="Model.Blocks" />
   }
   ```

10. Add the following to your `Views/_ViewImports.cshtml` file:

    ```csharp
    @addTagHelper *, GovUk.Frontend.AspNetCore
    @addTagHelper *, GovUk.Frontend.AspNetCore.Extensions
    ```

11. Update your layout to include the GOV.UK Design System scripts. A minimal layout file looks like this:

    ```csharp
    <!DOCTYPE html>
    <html lang="en">
      <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <partial name="TPR/Head" />
        @RenderSection("head", required: false)
      </head>
      <body class="govuk-template__body ">
        <partial name="GOVUK/BodyOpen" />
        <main>@RenderBody()</main>
        <partial name="GOVUK/BodyClosing" />
      </body>
    </html>
    ```

    Note that `TPR/Head` imports TPR styles on top of the GOV.UK Design System. You can use the partial `GOVUK/Head` instead to use the GOV.UK Design System styles only.

12. In `Startup.cs` add the following to the `ConfigureServices` method:

    ```csharp
    using GovUk.Frontend.Umbraco;

    public void ConfigureServices(IServiceCollection services)
    {
        // Other code, including services.AddUmbraco()...

        services.AddGovUkFrontendUmbracoExtensions(options =>
        {
           // Avoid adding scripts which require 'unsafe-inline' in the content security policy
            options.AddImportsToHtml = false;
        });

    }
    ```
